<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1. FC Kaiserslautern - Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212; /* Dark background */
            color: #e0e0e0; /* Light text color */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
    
        .container {
            width: 80%;
            max-width: 1200px;
            margin-top: 20px;
        }
    
        .header {
            text-align: center;
            background-color: #1f1f1f; /* Darker grey */
            color: #e0e0e0;
            padding: 20px;
            border-radius: 10px;
        }
    
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr; /* Two smaller boxes on the sides and one large box in the middle */
            grid-template-rows: 1fr 1fr; /* Two rows */
            gap: 20px;
            margin-top: 20px;
        }

        /* Box styling */
        .box {
            background-color: #1f1f1f;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 200px; /* Minimum height for each box to avoid overlap */
        }

        .box h2 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #e30613; /* Red accent color */
            background-color: #2c2c2c; /* Slightly lighter dark grey */
            text-align: center;
            font-size: 1.5em;
            padding: 10px;
            border-radius: 5px;
            flex-shrink: 0; /* Prevent shrinking */
        }

        /* Top Left: League table */
        #league-table-box {
            grid-column: 1 / 2; /* Span the first column */
            grid-row: 1 / 2; /* Span the first row */
            justify-content: flex-start;
            align-items: center;
        }
    
        /* Top Middle: Next match */
        #next-match-box {
            grid-column: 2 / 3; /* Span the second column */
            grid-row: 1 / 2; /* Span the first row */
            background-color: #2c2c2c; /* Slightly lighter dark grey */
            color: #ffffff;
            justify-content: center;
        }

        /* Styling for the next match display */
        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .team-logo-large {
            width: 50px; /* Large team logo */
            height: auto;
            vertical-align: middle;
        }

        .team-logo {
            width: 20px; /* Adjust the size as needed */
            height: auto;
            vertical-align: middle;
        }

        .match-date {
            font-size: 1.2em;
            margin-top: 10px;
            color: #e0e0e0;
        }

        /* Top Right: Upcoming matches */
        #upcoming-box {
            grid-column: 3 / 4; /* Span the third column */
            grid-row: 1 / 2; /* Span the first row */
            justify-content: flex-start;
        }

        .upcoming, .matches {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
        }

        .upcoming li, .matches li {
            background-color: #2c2c2c; /* Slightly lighter dark grey */
            margin: 10px 0;
            padding: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e30613; /* Red border */
        }

        .matches li span {
            flex: 1; /* Make spans take up equal space */
            text-align: center; /* Center align text in spans */
        }

        .matches li span:first-child {
            text-align: left; /* Align the first span to the left */
            margin-right: 10px; /* Add margin to the right */
        }

        .matches li span:last-child {
            text-align: right; /* Align the last span to the right */
            margin-left: 10px; /* Add margin to the left */
        }

        /* Bottom Left: Undefeated series */
        #unstoppable-box {
            grid-column: 1 / 2; /* Span the first column */
            grid-row: 2 / 3; /* Span the second row */
            color: #ffffff;
            justify-content: flex-start;
            align-items: center;
        }

        .stats {
            font-size: 4em; /* Large font size for the number */
            font-weight: bold;
        }

        /* Bottom Middle: Free space */
        #free-space-box {
            grid-column: 2 / 3; /* Span the second column */
            grid-row: 2 / 3; /* Span the second row */
            background-color: #1f1f1f; /* Dark grey */
            justify-content: center;
        }

        /* Bottom Right: Last games */
        #last-match-box {
            grid-column: 3 / 4; /* Span the third column */
            grid-row: 2 / 3; /* Span the second row */
            justify-content: flex-start;
        }
    
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.8em;
            color: #e0e0e0;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>1. FC Kaiserslautern - Dashboard</h1>
            <p>Übersicht über die ungeschlagene Serie und aktuelle Informationen</p>
        </div>

        <div class="dashboard">
            <!-- Top Left: League table -->
            <div class="box" id="league-table-box">
                <h2>Ligatabelle</h2>
                <!-- Placeholder content for league table -->
                <ul>
                    <li>1. Team A - 35 Punkte</li>
                    <li>2. Team B - 34 Punkte</li>
                    <li>3. Team C - 33 Punkte</li>
                    <!-- More teams... -->
                </ul>
            </div>

            <!-- Top Middle: Next match -->
            <div class="box" id="next-match-box">
                <h2>Nächstes Spiel</h2>
                <div class="match-teams">
                    <img src="logos/team1.png" alt="Team 1" class="team-logo-large">
                    <span>vs</span>
                    <img src="logos/team2.png" alt="Team 2" class="team-logo-large">
                </div>
                <p class="match-date">-/-</p>
            </div>

            <!-- Top Right: Upcoming matches -->
            <div class="box" id="upcoming-box">
                <h2>Nächste Spiele</h2>
                <ul class="upcoming" id="upcoming-list">
                    <!-- Upcoming matches will be dynamically inserted here -->
                </ul>
            </div>

            <!-- Bottom Left: Undefeated series -->
            <div class="box" id="unstoppable-box">
                <h2>Ungeschlagene Spiele</h2>
                <p class="stats" id="unstoppable-count">0</p>
            </div>

            <!-- Bottom Middle: Free space -->
            <div class="box" id="free-space-box">
                <!-- Free space -->
            </div>

            <!-- Bottom Right: Last games -->
            <div class="box" id="last-match-box">
                <h2>Letzte Spiele</h2>
                <ul class="matches" id="matches-list">
                    <!-- Last games will be dynamically inserted here -->
                </ul>
            </div>
        </div>

        <div class="footer">
            <p>Diese Seite verwendet eine API, um die neuesten Spiele und Ergebnisse des 1. FC Kaiserslautern anzuzeigen.</p>
        </div>
    </div>

    <script>
        async function fetchData() {
            const apiKey = '956396358d6241c25ad2b095cc2b58d3';
            const teamId = 745;
            const season = 2024;
            
            const leagues = [79, 81];
    
            const matchesData = [];
            const upcomingData = [];
    
            // Function to fetch data for a specific league
            async function fetchLeagueData(leagueId, status) {
                const url = `https://v3.football.api-sports.io/fixtures?team=${teamId}&season=${season}&status=${status}&league=${leagueId}`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: { 
                        'x-apisports-key': apiKey,
                    }
                });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                return await response.json();
            }
    
            // Function to format the team name for the logo filename
            function getTeamLogo(teamName) {
                const specialCharsMap = {
                    'ä': 'ae',
                    'ö': 'oe',
                    'ü': 'ue',
                    'ß': 'ss',
                    'Ä': 'Ae',
                    'Ö': 'Oe',
                    'Ü': 'Ue'
                };
                
                const formattedName = teamName.replace(/\s+/g, '_') // Replace spaces with underscores
                    .replace(/[äöüßÄÖÜ]/g, char => specialCharsMap[char]); // Replace special characters
    
                return `logos/${formattedName}.png`; // Path to the logo directory
            }
    
            try {
                // Fetch data for each league
                for (const leagueId of leagues) {
                    const matchesResponse = await fetchLeagueData(leagueId, 'FT');
                    matchesData.push(...matchesResponse.response);
    
                    const upcomingResponse = await fetchLeagueData(leagueId, 'NS');
                    upcomingData.push(...upcomingResponse.response);
                }
    
                // Sort matches by date (Past matches)
                matchesData.sort((a, b) => new Date(a.fixture.date) - new Date(b.fixture.date));
                // Sort upcoming matches
                upcomingData.sort((a, b) => new Date(a.fixture.date) - new Date(b.fixture.date));
    
                // Update unbeaten matches
                const unstoppableCount = matchesData.filter(match =>
                    (match.teams.home.name === '1. FC Kaiserslautern' && match.score.fulltime.home >= match.score.fulltime.away) ||
                    (match.teams.away.name === '1. FC Kaiserslautern' && match.score.fulltime.away >= match.score.fulltime.home)
                ).length;
                document.getElementById('unstoppable-count').innerText = unstoppableCount;
    
                // Update last matches
                const matchesList = document.getElementById('matches-list');
                const lastMatches = matchesData.slice(-5); // Get the last 5 matches
                lastMatches.forEach(match => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = 
                        `<span>
                            <img src="${getTeamLogo(match.teams.home.name)}" alt="${match.teams.home.name}" class="team-logo">
                            ${match.teams.home.name} 
                            <span style="color: #e30613; font-weight: bold;">${match.score.fulltime.home} - ${match.score.fulltime.away}</span>
                            <img src="${getTeamLogo(match.teams.away.name)}" alt="${match.teams.away.name}" class="team-logo">
                            ${match.teams.away.name}
                        </span>
                        <span>${new Date(match.fixture.date).toLocaleDateString()}</span>`;
                    matchesList.appendChild(listItem);
                });
    
                // Update upcoming matches
                const upcomingList = document.getElementById('upcoming-list');
                upcomingData.forEach(match => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = 
                        `<span>
                            <img src="${getTeamLogo(match.teams.home.name)}" alt="${match.teams.home.name}" class="team-logo">
                            ${match.teams.home.name} vs ${match.teams.away.name}
                            <img src="${getTeamLogo(match.teams.away.name)}" alt="${match.teams.away.name}" class="team-logo">
                        </span>
                        <span>${new Date(match.fixture.date).toLocaleDateString()}</span>`;
                    upcomingList.appendChild(listItem);
                });
    
                // Update the next match (Top Middle)
                const nextMatch = upcomingData[0];
                document.querySelector('#next-match-box .team-logo-large:nth-child(1)').src = getTeamLogo(nextMatch.teams.home.name);
                document.querySelector('#next-match-box .team-logo-large:nth-child(1)').alt = nextMatch.teams.home.name;
                document.querySelector('#next-match-box .team-logo-large:nth-child(3)').src = getTeamLogo(nextMatch.teams.away.name);
                document.querySelector('#next-match-box .team-logo-large:nth-child(3)').alt = nextMatch.teams.away.name;
                document.querySelector('#next-match-box .match-date').innerText = new Date(nextMatch.fixture.date).toLocaleDateString('de-DE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
    
        fetchData();
    </script>
</body>
</html>